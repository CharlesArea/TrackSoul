/**
 * @Author: Charles Lo <charlesu>
 * @Date:   2020-06-24 17:15
 * @Email:  Developer.CharlesLo@gmail.com
 * @Project: NotesCLI
 * @Last modified by:   charlesu
 * @Last modified time: 2020-06-26 21:52
 */



const sdk_name="TrackSoul",data_endpoint="https://0a08e46e402c.ngrok.io/users_data",script_domain=document.getElementById(sdk_name).getAttribute("domain_name"),client_id=document.getElementById(sdk_name).getAttribute("client_id"),client_key=document.getElementById(sdk_name).getAttribute("client_key"),input_tracking=!0,behaviour_tracking=!0;function actions_on_page(t){const e=document.querySelector("input");if(input_tracking&&e.addEventListener("input",function(t){var e=checkCookie();client_action_on_element=t.srcElement,current_visiting_url=window.location.href,input_time=millisToMinutesAndSeconds(performance.now()),input_data=t.data,client_ip_address=get_client_ip_address(),input_data={data_type:"visitor_typing",current_visiting_url:current_visiting_url,client_cookie_id:e,client_ip_address:client_ip_address,input_time:input_time,client_action_on_element:client_action_on_element,input_data:input_data},console.log(input_data)}),behaviour_tracking){var i={};document.addEventListener("click",function(e){var n=window.location.href,o=e.clientX,a=e.clientY,r=e.pageX,c=e.pageY,_=e.type,s=checkCookie();client_action_on_element=e.srcElement,click_time=millisToMinutesAndSeconds(performance.now()),data_type="visitor_behaviour",s=checkCookie(),client_ip_address=get_client_ip_address(),i={data_type:data_type,current_visiting_url:n,client_position_x:o,client_position_y:a,page_position_x:r,page_position_y:c,client_action:_,client_action_on_element:client_action_on_element,click_time:click_time,client_cookie_id:s,client_ip_address:client_ip_address};var d=window.location.hostname;t==d?(console.log(i),console.log("Data has been successfully logged"),posting_data(i)):(console.log(i),console.log("I cannot post data from another domain"))})}return i}function visitor_information(t){var e,i=window.location.href,n=document.referrer,o=navigator.userAgent,a=navigator.language,r=navigator.platform;return data_type="visitor_visiting",server_time=currect_date_time(),currect_domain=window.location.hostname,client_cookie_id=checkCookie(),client_ip_address=get_client_ip_address(),e={data_type:data_type,currect_domain:currect_domain,current_visiting_url:i,visitor_from:n,visitor_browser:o,visitor_os_platform:r,visitor_browser_language:a,server_time:server_time,client_cookie_id:client_cookie_id,client_ip_address:client_ip_address},console.log(e),t==currect_domain?(posting_data(e),console.log("Data has been successfully logged")):console.log("I cannot post data from another domain"),e}function millisToMinutesAndSeconds(t){var e=Math.floor(t/6e4),i=(t%6e4/1e3).toFixed(0);return e+":"+(i<10?"0":"")+i}function setCookie(t,e,i){var n=new Date;n.setTime(n.getTime()+24*i*60*60*1e3);var o="expires="+n.toUTCString();document.cookie=t+"="+e+";"+o+";path=/"}function getCookie(t){for(var e=t+"=",i=document.cookie.split(";"),n=0;n<i.length;n++){for(var o=i[n];" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(e))return o.substring(e.length,o.length)}return""}function checkCookie(){var t=getCookie("shiling_tracking");return""!=t?(console.log(t),t):(visitor_id=make_tracking_id(),""!=visitor_id&&null!=visitor_id?(setCookie("shiling_tracking",visitor_id,365),!1):void 0)}function under_the_same_domain(t,e){}function posting_data(t){var e=new XMLHttpRequest;e.open("POST",data_endpoint),e.setRequestHeader("Content-Type","application/json;charset=UTF-8"),e.send(JSON.stringify(t))}function make_tracking_id(t=10){for(var e="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=i.length,o=0;o<t;o++)e+=i.charAt(Math.floor(Math.random()*n));return e}function currect_date_time(){var t=new Date;return t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()+" "+t.getHours()+":"+t.getMinutes()+":"+t.getSeconds()}function ajax(t,e,i,n=null){var o;try{o=new XMLHttpRequest}catch(t){try{o=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{o=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){return alert("Your browser does not support Ajax."),!1}}}return o.onreadystatechange=function(){4==o.readyState&&i(o)},o.open(e,t,!0),o.send(n),o}function get_client_ip_address(){ajax("https://www.cloudflare.com/cdn-cgi/trace","get",function(t){client_information=t.responseText;var e=client_information.split("\n");e[2].split("=")[1],e[8];return client_id})}window.onload=function(){actions_on_page(script_domain),visitor_information(script_domain)};
